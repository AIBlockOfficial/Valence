name: build-scan

on:
  push:
    branches: 
      - main
      - develop

permissions:
  contents: read
  packages: write
  security-events: write

env:
  CARGO_TERM_COLOR: always

jobs:
  build: 
    uses: aiblockofficial/workflows/.github/workflows/build.yml@main
    with: 
      REGISTRY:  ${{ vars.REGISTRY }}
      REPOSITORY: ${{ vars.REPOSITORY }}
      NODE_TYPE: ${{ vars.NODE_TYPE }}
  scan-image:
    uses: ${{ vars.ORGANISATION_WORKFLOW_PATH }}/scan-image.yml@main
    secrets: inherit
    needs: build
    with:
      IMAGE: ${{ vars.REGISTRY }}/${{ vars.ORGANISATION_NAME }}/node-${{ vars.NODE_TYPE }}:${{ github.sha }}
